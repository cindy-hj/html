<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>메인</title>
    <link href="css/style2.css" rel="stylesheet" />
</head>

<body>
    <div class="container">
        <header>
            <h3>header</h3>
        </header>
        <section>
            <div class="s_a" id="list"></div>

            <div class="s_b" id="menu1">
                <div class="item">
                    <label class="lbl">아이디</label>
                    <input type="text" id="id"/>
                </div>
                <div class="item">
                    <label class="lbl">비밀번호</label>
                    <input type="password" id="pw"/>
                </div>
                <div class="item">
                <label class="lbl"></label>
                <button onclick="handleLogin()">로그인</button>
                <a href="/join2.html"><button>회원가입</button></a> 
                </div>
            </div>

            <div class="s_b" id="menu2">
                <div class="item">
                    <a href="/iteminsert2.html"><label class="lbl">상품 등록</label></a>
                </div>
                <div class="item">
                    <a href="/itemseller2.html"><label class="lbl">등록한 상품 관리</label></a>
                </div>
                <div class="item">
                    <a href="/board2.html"><label class="lbl">문의 게시판</label></a>
                </div>
                <div class="item">
                    <a href="/logout2.html"><label class="lbl"><button>로그아웃</button></label></a>
                </div>
            </div>
        </section>
    </div>

    <footer>
        <h3>footer</h3>
    </footer>
    </div>

    <script src="js/axios.min.js" type="text/javascript"></script>
    <script>
        const id = document.getElementById('id') ;
        const pw = document.getElementById('pw') ;
        const menu1 = document.getElementById('menu1') ;
        const menu2 = document.getElementById('menu2') ;
        const token = sessionStorage.getItem('TOKEN');
        // console.log(token);
        const list = document.getElementById('list');

        const handleData = async() => {
            const url = `http://1.234.5.158:23000/item101/selectlistpage.json?page=1`;
            const headers = {"Contet-Type":"application/json"}
            const { data } = await axios.get(url, {headers});
            // console.log('handleData', data);
            if(data.status === 200) {
                for(tmp of data.result) {
                    // console.log(tmp);
                    list.innerHTML +=
                        `<div>` +
                            `<p><img src="${tmp.img}" style="width:100%; height:150px"></p>` +
                            `<p>${tmp.name}</p>` +
                        `</div>` ;
                }
            }
        }
        handleData();

        const handleLogin = async() => {
            if(id.value.length <= 0) {
                alert('아이디를 입력하세요.')
                id.focus();
                return false;
            }
            if(pw.value.length <= 0) {
                alert('비밀번호를 입력하세요.')
                pw.focus();
                return false;
            }

            const url = `http://1.234.5.158:23000/member101/select.json`;
            const headers = {"Content-Type":"application/json"} ;
            const body = {
                id: id.value,
                pw: pw.value
            }
            const { data } = await axios.post(url, body, {headers});
            // console.log(data);
            if(data.status === 200) {
                sessionStorage.setItem('TOKEN', data.result);
                window.location.href="/main2.html";
            }
            else {
                alert('아이디 또는 비밀번호를 확인하세요.')
            }
        }
   
        if(token === null) {
            menu1.style.display = "block";
            menu2.style.display = "none";
        }
        else {
            menu1.style.display = "none";
            menu2.style.display = "block";
        }
    </script>
</body>

</html>